#! https://zhuanlan.zhihu.com/p/443299880
# Coq集合论讲座 (2-12: ε层级, ζ层级, η层级)

> [GitHub - choukh/Baby-Set-Theory](https://github.com/choukh/Baby-Set-Theory)  
> Q群: 893531731

本文是Coq集合论讲座第2季第12讲. 上一讲: [Coq集合论讲座 (2-11: 迭代幂次)](https://zhuanlan.zhihu.com/p/442886905)

## ε层级

**定义** ε: 以ω为底的幂运算的不动点的枚举. 其值称为ε数, 其值域(真类)称为ε层级. 我们将 $ε(α)$ 记作 $ε_α$.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Definition ε := 不动点枚举 (幂运算 ω).
```

由构造, ε为序数运算, 且为序数嵌入, 且其值为不动点.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Lemma ε为序数运算 : 为序数运算 ε.
Proof. apply 不动点枚举为序数运算. auto. Qed.

Lemma ε为序数嵌入 : 为序数嵌入 ε.
Proof. apply 不动点枚举为序数嵌入. auto. Qed.
Local Hint Resolve ε为序数运算 ε为序数嵌入 : core.

Lemma ε数为不动点 : ∀α ⋵ ON, ω ^ (ε α) = ε α.
Proof. apply 不动点枚举枚举之. auto. Qed.
```

幂运算相关定律经常要求运算数大于1. 我们先证ε数大于1. 考虑到一般性, 我们证明在零处不为零的序数嵌入的不动点不为零.

**定理** 不动点不为零: 对任意序数嵌入 $F$, 如果 $F(0) ≠ 0$, 那么 $F$ 的任意不动点 $G(α) ≠ 0$.

证明: 因为 $G(α)$ 为 $F$ 的不动点, 所以有 $F(G(α)) = G(α)$. 若 $G(α) = 0$, 那么 $F(0) = 0$, 与前提矛盾. ∎

```Coq
(* Theory/OrdinalOperation.v *)
(* 不动点枚举Section内 *)

Theorem 不动点不为零 : ∀α ⋵ ON, F ∅ ≠ ∅ → G α ≠ ∅.
Proof.
  intros α Hα HF0. pose proof (不动点枚举枚举之 α Hα).
  intros H0. rewrite H0 in H. auto.
Qed.
```

**引理** ε数不为零: 对任意序数α, $ε_α ≠ 0$.

证明: 由"不动点不为零", 只需证 $ω^0 ≠ 0$, 显然成立. ∎

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Lemma ε数不为零 : ∀α ⋵ ON, ε α ≠ ∅.
Proof with auto.
  intros α Hα. apply 不动点不为零... rewrite 零次幂... auto using 零不为一.
Qed.
```

**引理** ε数不为一: 对任意序数α, $ε_α ≠ 1$.

证明: 由不动点有 $ω^{ε_α} = ε_α$. 若 $ε_α = 1$, $ω^1 = ω = 1$, 与 $1∈ω$ 矛盾. ∎

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Lemma ε数不为一 : ∀α ⋵ ON, ε α ≠ 1.
Proof with auto.
  intros α Hα. assert (ω ^ ε α = ε α). apply ε数为不动点...
  intros H0. rewrite H0, 一次幂 in H...
  apply 序数反自反 with 1. apply ω为序数集... rewrite <- H at 2...
Qed.
```

由以上两条引理可知任意ε数大于一.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Lemma ε数大于一 : ∀α ⋵ ON, 1 ∈ ε α.
Proof with auto.
  intros. apply 不为零和一的序数大于一... apply ε数不为零... apply ε数不为一...
Qed.
Local Hint Resolve ε数不为零 ε数不为一 ε数大于一 : core.
```

回顾[2-10](https://zhuanlan.zhihu.com/p/439161308)的加法不动点和乘法不动点, 令其中的 $ξ = ω$, 那么有

$$σ_0 = ω⋅ω = \overbrace{ω+ω+...+ω}^{ω个ω}$$

$$π_0 = ω^ω = \overbrace{ω⋅ω⋅...⋅ω}^{ω个ω}$$

以此类推, 幂运算的不动点应该有

$$ε_0 = {^ω{ω}} = \left.ω^{ω^{...^ω}}\right\}ω个ω$$

**定理** ε_0 : ε层级的最小数 $ε_0 = {^ω{ω}}$.

证明: 用外延公理.

- 先证 $ε_0 ⊆ {^ω{ω}}$, 即证 $ε_0 ≤ {^ω{ω}}$. 由最小不动点的性质, 只需证 ${^ω{ω}}$ 是不动点, 即证 $ω^{^ω{ω}} = {^ω{ω}}$, 即证 ${^{ω⁺}{ω}} = {^ω{ω}}$, 此即上一讲引理"左迭代在ω后继处不递增"的实例.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Theorem ε_0 : ε ∅ = ω ^^ᴸ ω.
Proof with auto.
  apply 包含的反对称性.
  - apply 小于等于即包含... unfold ε. rewrite 不动点枚举_0...
    apply 最小不动点为之... rewrite <- 左迭代后继次, 左迭代在ω后继处不递增...
```

- 对任意 $x∈{^ω{ω}} = \sup\{^n{ω}|n∈ω\}$, 存在 $n∈ω$ 使得 $x∈{^n{ω}}$. 要证 $x∈ε_0$, 由传递性, 只需证 ${^n{ω}}∈ε_0$. 归纳n.
  - 起始阶段, 要证 ${^0{ω}}∈ε_0$, 即证 $ω∈ω^{ε_0}$, 由幂运算右侧严格放大得证.
  - 归纳阶段, 假设 ${^{n}{ω}}∈ε_0$, 要证 ${^{n⁺}{ω}}∈ε_0$, 即证 $ω^{^{n}{ω}}∈ω^{ε_0}$, 由幂运算的保序性得证. ∎

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

  - intros x Hx. rewrite 左迭代极限次 in Hx...
    apply 集族并除去 in Hx as [n [Hn Hx]].
    apply 序数传递 with (ω ^^ᴸ n)... clear Hx. 归纳 n.
    + rewrite 左迭代零次, <- ε数为不动点... apply 幂运算放大...
    + rewrite 左迭代后继次, <- ε数为不动点... apply 幂运算保序...
Qed.
```

超越 $ε_0$, 我们有 $ε_1$. 为了直观地体会 $ε_1$ 有多大, 我们不加证明地列出介于$ε_0$ 与 $ε_1$之间的一些序数, 它们不重要, 也不会在后文中再次出现.

$$
  \begin{aligned}
  ε_0+ω & = \sup\{ε_0+1,ε_0+2,ε_0+3,...\} \\
  ε_0⋅2 = ε_0+ε_0 & = \sup\{ε_0+ω,ε_0+ω^ω,ε_0+ω^{ω^ω},...\} \\
  ω^{ε_0+1} = ω^{ε_0}⋅ω = ε_0⋅ω & = \sup\{ε_0,ε_0⋅2,ε_0⋅3,...\} \\
  ω^{ω^{ε_0+1}} = ω^{ε_0⋅ω} & = \sup\{ε_0,ω^{ε_0⋅2},ω^{ε_0⋅3},...\}
  \end{aligned}
$$

至于$ε_1$, 我们直接看ε在后继处的值. 回顾后继不动点的定义

```Coq
(* Theory/OrdinalOperation.v *)

(* 任意不动点Section内 *)
Local Notation G := (序数递归 α F).
Local Notation A := {G n | n ∊ ω}.
Definition 任意不动点 := sup A.

(* 后继不动点Section内 *)
Definition 后继不动点 := 任意不动点 F α⁺.
```
这里 F = (λ α, $ω ^ α$), 将其视作隐式参数, 并且将"后继不动点"函数记作S, "任意不动点"函数记作A, 那么

$$ε_{α⁺} = S(ε_α) = A({ε_α + 1}) = \sup\{G(n)|n∈ω\}$$

其中

$$G(n) = {^n{\stackrel{(ε_α + 1)}{ω}}} = \left.ω^{ω^{...ω^{ε_α + 1}}}\right\}n个ω$$

其中,${^n{\stackrel{(ε_α + 1)}{ω}}}$的记法是我们上一讲末尾定义的顶迭代. 结合以上两式有

$$ε_{α⁺} = \sup\{ε_α + 1,ω^{ε_α + 1},ω^{ω^{ε_α + 1}},...\}$$

直观上, 后继ε数等于以当前ε数的后继为顶的无穷层ω指数塔, 即

$$ε_{α⁺} = \left.ω^{ω^{...ω^{ε_α + 1}}}\right\}ω个ω$$

用顶迭代的记法, 即

$$ε_{α⁺} = {^ω{\stackrel{(ε_α + 1)}{ω}}}$$

至于形式化证明, Coq可以自动识别出当 F = (λ α, $ω ^ α$)时, 后继不动点的定义与顶迭代在极限处的定义是一致的.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Theorem ε_后继_ω塔 : ∀α ⋵ ON, ε α⁺ = (ω ^^ᵀ ω) (ε α)⁺.
Proof. intros. unfold ε. rewrite 不动点枚举_后继, 顶迭代极限次; auto. Qed.
```

在非零极限处, 我们有

$$ε_λ = \sup\{ε_α|α∈λ\}$$

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Theorem ε_极限 : 极限处连续 ε.
Proof. apply 不动点枚举_极限. Qed.
```

ε无法像σ和π那样将零, 后继和非零极限处的运算写成统一的表达式, 我们只能如下分别列出. 这种写法在有些教科书上就作为ε数的定义, 而我们是从更抽象的"不动点枚举"来定义, 并证明了下式成立.

$$
  \begin{aligned}
  ε_0 & = {^ω{ω}} \\
  ε_{α⁺} & = {^ω{\stackrel{(ε_α + 1)}{ω}}} \\
  ε_λ & = \sup\{ε_α|α∈λ\}
  \end{aligned}
$$

## ε塔

这节讲ε后继表达式的另一种形式, 相对于上一节的ω塔形式, 这节的可以称为ε塔. 首先, 不难发现

$$
  \begin{aligned}
  {^0{\stackrel{(ε_α+1)}{ω}}} & = ε_α+1 \\
  {^1{\stackrel{(ε_α+1)}{ω}}} & = ω^{ε_α+1} = ω^{ε_0}⋅ω = ε_0⋅ω \\
  {^2{\stackrel{(ε_α+1)}{ω}}} & = ω^{{^1{\stackrel{(ε_α+1)}{ω}}}} = ω^{ε_0⋅ω} = (ω^{ε_0})^ω = {ε_0}^ω \\
  {^3{\stackrel{(ε_α+1)}{ω}}} & = ω^{{^2{\stackrel{(ε_α+1)}{ω}}}} = ω^{{ε_0}^ω} = ω^{{ε_0}^{1+ω}} = ω^{{ε_0}⋅{ε_0}^ω} = (ω^{ε_0})^{{ε_0}^ω} = {ε_0}^{{ε_0}^ω}
  \end{aligned}
$$

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

(* ε'顶ω塔 := 以ε数的后继为顶的ω塔 *)

Fact ε'顶ω塔0层 : ∀α ⋵ ON, (ω ^^ᵀ 0) (ε α)⁺ = (ε α)⁺.
Proof. intros. rewrite 顶迭代零次; auto. Qed.

Fact ε'顶ω塔1层 : ∀α ⋵ ON, (ω ^^ᵀ 1) (ε α)⁺ = ε α * ω.
Proof. intros. simpl. rewrite 顶迭代后继次, ε'顶ω塔0层, 后继次幂, ε数为不动点; auto. Qed.

Fact ε'顶ω塔2层 : ∀α ⋵ ON, (ω ^^ᵀ 2) (ε α)⁺ = ε α ^ ω.
Proof. intros. simpl. rewrite 顶迭代后继次, ε'顶ω塔1层, 指数积运算律, ε数为不动点; auto. Qed.

Fact ε'顶ω塔3层 : ∀α ⋵ ON, (ω ^^ᵀ 3) (ε α)⁺ = ε α ^ (ε α ^ ω).
Proof with auto.
  intros. simpl. rewrite 顶迭代后继次, ε'顶ω塔2层...
  rewrite <- 一加ω等于ω at 2...
  rewrite 指数和运算律, 一次幂, 指数积运算律, ε数为不动点...
Qed.
```

由此猜想, n⁺层$ε_α⁺$顶ω塔等于n层ω顶$ε_α$塔, 即 ${^{n⁺}{\stackrel{(ε_α+1)}{ω}}} = {^{n}{\stackrel{ω}{ε_α}}}$. 为了证明它, 我们需要先证明一个定理.

**定理** ω幂对加法的吸收律: 对任意序数α和β, 如果 $α<β$, 那么 $ω^α + ω^β = ω^β$.

证明: 超限归纳β, 有归纳假设 $∀γ∈β,ω^α + ω^γ = ω^γ$. 讨论β.

- 若为零, $α<0$, 矛盾.
- 若为后继, 有前提 $α<β⁺$, 要证 $ω^α + ω^β⁺ = ω^β⁺$, 即证 $ω^α + ω^β⋅ω = ω^β⋅ω$.
  - 若 $α<β$. 左边 = $ω^α + ω^β⋅(1+ω) = ω^α + ω^β + ω^β⋅ω = ω^β + ω^β⋅ω = ω^β⋅(1+ω) = ω^β⋅ω$ = 右边. 其中第三个等号用了归纳假设.
  - 若 $α=β$. 左边 = $ω^β⋅1 + ω^β⋅ω = ω^β⋅(1+ω) = ω^β⋅ω$ = 右边.
- 若为非零极限, 用外延公理.

```Coq
(* Arith/Ord.v *)

Theorem ω幂对加法的吸收律 : ∀β ⋵ ON, ∀α ∈ β, ω ^ α + ω ^ β = ω ^ β.
Proof with auto.
  超限归纳 β Hβ. intros α Hαβ. assert (Hα: α ⋵ ON). eauto.
  超限讨论 β. 空集归谬.
  - apply 后继除去 in Hαβ as []; rewrite 后继次幂...
    + rewrite <- 一加ω等于ω at 3... rewrite 乘法分配律, 乘一, <- 加法结合律, 归纳假设...
      rewrite <- (乘一 (ω ^ β)) at 1... rewrite <- 乘法分配律, 一加ω等于ω...
    + subst. rewrite <- (乘一 (ω ^ β)) at 1... rewrite <- 乘法分配律, 一加ω等于ω...
  - 外延 x Hx.
```

- 对任意 $x∈ω^α + ω^β = \sup\{ω^α + γ|γ∈ω^β\}$, 存在 $γ∈ω^β$ 使得 $x∈ω^α + γ$. 又 $γ∈ω^β = \sup\{ω^δ|δ∈β\}$, 存在 $δ∈β$ 使得 $γ∈ω^δ$. 要证 $x∈ω^β$, 由传递性只需证 $ω^α + γ∈ω^β$.
  - 若 $α ∈ δ$, 由归纳假设有 $ω^α + ω^δ = ω^δ$. 由 $γ∈ω^δ$ 和加法保序性有 $ω^α + γ∈ω^α + ω^δ$. 由 $δ∈β$ 和幂运算保序性有 $ω^δ∈ω^β$. 由传递性即得 $ω^α + γ∈ω^β$.
  - 若 $α ∉ δ$, 有 $δ ∈ α⁺$. 由幂运算保序性有 $γ∈ω^δ∈ω^α⁺$. 由加法保序性有 $ω^α + γ∈ω^α + ω^α⁺ = ω^α⁺$. 其中等号处用了归纳假设. 现在要证 $ω^α + γ∈ω^β$, 只需证 $ω^α⁺∈ω^β$, 即证 $α⁺∈β$. 由前提 $α<β$ 以及β为极限得证.

```Coq
(* 紧接上一段代码 *)

    + rewrite 加极限 in Hx... 2: apply 幂为极限_右... 2: intros H; apply 幂为零 in H...
      apply 集族并除去 in Hx as [γ [Hγ Hx]]. rewrite 极限次幂 in Hγ...
      apply 集族并除去 in Hγ as [δ [Hδ Hγ]]. assert (Hδo: δ ⋵ ON). eauto.
      apply 序数传递 with (ω ^ α + γ)... 排中 (α ∈ δ).
      * apply 序数传递 with (ω ^ α + ω ^ δ)... apply 加法保序...
        rewrite 归纳假设... apply 幂运算保序...
      * assert (δ ∈ α⁺). apply 小于等于即小于后继... 反证. apply 序数可换 in 反设...
        assert (α⁺ ∈ β). apply 极限序数有其任意元素的后继...
        apply 序数传递 with (ω ^ α + ω ^ α⁺)... apply 加法保序...
        apply 序数传递 with (ω ^ δ)... apply 幂运算保序... 
        rewrite 归纳假设... apply 幂运算保序...
```

- 对任意 $x∈ω^β = \sup\{ω^γ|γ∈β\}$, 存在 $γ∈β$ 使得 $x∈ω^γ$. 由幂运算保序性有 $ω^γ∈ω^β$. 要证 $x∈ω^α + ω^β = \sup\{ω^α + γ|γ∈ω^β\}$, 只需证 $x∈ω^α + ω^γ$. 由传递性只需证 $ω^γ ≤ ω^α + ω^γ$, 此即加法的左侧弱放大. ∎

```Coq
(* 紧接上一段代码 *)

    + rewrite 极限次幂 in Hx...
      apply 集族并除去 in Hx as [γ [Hγ Hx]]. assert (Hγo: γ ⋵ ON). eauto.
      rewrite 加极限... 2: apply 幂为极限_右... 2: intros H; apply 幂为零 in H...
      apply 集族并介入 with (ω ^ γ). apply 幂运算保序...
      apply 序数传递_右弱 with (ω ^ γ)... apply 加法弱放大...
Qed.
```

**引理** ε'顶ω塔n'层等于ω顶ε塔n层: 对任意序数α和任意非零自然数n有 ${^{n⁺}{\stackrel{(ε_α+1)}{ω}}} = {^{n}{\stackrel{ω}{ε_α}}}$.

证明: 归纳n.

- 起始阶段, n非零, 从1开始, 即证 ${^{2}{\stackrel{(ε_α+1)}{ω}}} = {^{1}{\stackrel{ω}{ε_α}}} = {ε_0}^ω$, 前面已证.

- 归纳阶段, 假设 ${^{n⁺}{\stackrel{(ε_α+1)}{ω}}} = {^{n}{\stackrel{ω}{ε_α}}}$, 要证 ${^{n⁺⁺}{\stackrel{(ε_α+1)}{ω}}} = {^{n⁺}{\stackrel{ω}{ε_α}}}$.

$$左边 = ω^{ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}}$$
$$右边 = {ε_α}^{^{n}{\stackrel{ω}{ε_α}}} = {ε_α}^{^{n⁺}{\stackrel{(ε_α+1)}{ω}}} = {ε_α}^{ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}} = {(ω^{ε_α})}^{ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}} = ω^{{ε_α}⋅{ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}}}$$

现在左右两边都以ω为底, 去掉它, 即证

$${ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}} = {ε_α}⋅{ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}}$$

$$右边 = {ω^{ε_α}}⋅{ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}} = ω^{{ε_α}+{^{n}{\stackrel{(ε_α+1)}{ω}}}}$$

左右两边又都以ω为底了, 去掉它, 即证

$${^{n}{\stackrel{(ε_α+1)}{ω}}} = {ε_α}+{^{n}{\stackrel{(ε_α+1)}{ω}}}$$

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Lemma ε'顶ω塔n'层等于ω顶ε塔n层 : ∀α ⋵ ON, ∀n ∈ ω, n ≠ 0 → (ω ^^ᵀ n⁺) (ε α)⁺ = (ε α ^^ᵀ n) ω.
Proof with auto.
  intros α Hα n Hn. 归纳 n; intros H1. exfalso...
  排中 (n = 0). subst. rewrite ε'顶ω塔2层, 顶迭代一次...
  rewrite 顶迭代后继次, 顶迭代后继次, 顶迭代后继次, <- 归纳假设, 顶迭代后继次...
  rewrite <- ε数为不动点 at 2... rewrite <- 指数积运算律... f_equal.
  rewrite <- ε数为不动点 at 2... rewrite <- 指数和运算律... f_equal.
```

讨论n. n非零, 只能为后继, 即证

$${^{n⁺}{\stackrel{(ε_α+1)}{ω}}} = {ε_α}+{^{n⁺}{\stackrel{(ε_α+1)}{ω}}}$$

即证

$$ω^{^{n}{\stackrel{(ε_α+1)}{ω}}} = ω^{ε_α}+{ω^{^{n}{\stackrel{(ε_α+1)}{ω}}}}$$

由"ω幂对加法的吸收律", 只需证 ${ε_α} < {^{n}{\stackrel{(ε_α+1)}{ω}}}$. 归纳n.

- 起始阶段, 要证 ${ε_α} < {^{0}{\stackrel{(ε_α+1)}{ω}}} = ε_α+1$, 显然成立.

- 后继阶段, 假设 ${ε_α} < {^{n⁺}{\stackrel{(ε_α+1)}{ω}}}$, 要证 ${ε_α} < {^{n⁺⁺}{\stackrel{(ε_α+1)}{ω}}} = ω^{^{n⁺}{\stackrel{(ε_α+1)}{ω}}}$. 由传递性只需证 ${^{n⁺}{\stackrel{(ε_α+1)}{ω}}} ≤ ω^{^{n⁺}{\stackrel{(ε_α+1)}{ω}}}$, 此即幂运算的左侧弱放大. ∎

```Coq
(* 紧接上一段代码 *)

  讨论 n. exfalso...
  rewrite <- ε数为不动点 at 2... rewrite 顶迭代后继次... symmetry.
  apply ω幂对加法的吸收律... clear H H1 归纳假设 Hn.
  归纳 n. rewrite 顶迭代零次...
  rewrite 顶迭代后继次... apply 序数传递_右弱 with ((ω ^^ᵀ n) (ε α)⁺)... apply 幂运算弱放大...
Qed.
```

我们不加证明地直接给出以下两条引理, 它们相当直观. 第1条就是稍微换了一下表述而已. 第2条是说截掉序列开头的有限个项, 其极限不变. 如想了解严格证明, 请自行运行Coq代码.

**引理** 弱递增无穷序列极限与起始无关: 对任意有限弱递增的序数运算F, 以及任意自然数n, $\sup\{F(k) | k ∈ ω - n⁺\} = \sup\{F(k⁺) | k ∈ ω - n\}$.

**引理** 弱保序无穷序列极限与起始无关: 对任意有限弱保序的序数运算F, 以及任意自然数n, $\sup\{F(k) | k ∈ ω\} = \sup\{F(k) | k ∈ ω - n\}$.

```Coq
(* Theory/OrdinalOperation.v *)

Lemma 弱递增无穷序列极限与起始无关 : ∀n ∈ ω, ∀ F, 为序数运算 F → 有限弱递增 F →
  sup {F k | k ∊ ω - n⁺} = sup {F k⁺ | k ∊ ω - n}.
Proof with auto.
  intros n Hn F 运算 递增. 外延.
  - apply 集族并除去 in H as [k [Hk H]]. apply 分离除去 in Hk as [Hk Hk'].
    apply 集族并介入 with k. apply 分离介入... apply 序数传递_右弱 with (F k)...
  - apply 集族并除去 in H as [k [Hk H]]. apply 分离除去 in Hk as [Hk Hk'].
    apply 集族并介入 with k⁺⁺. apply 分离介入... 2: apply 序数传递_右弱 with (F k⁺)...
    intros H'. apply Hk'. apply 后继保序... apply 序数传递 with k⁺⁺...
Qed.

Lemma 弱保序无穷序列极限与起始无关 : ∀n ∈ ω, ∀ F, 为序数运算 F → 有限弱保序 F →
  sup {F k | k ∊ ω} = sup {F k | k ∊ ω - n}.
Proof with auto.
  intros n Hn F 运算 保序. 外延.
  - apply 集族并除去 in H as [k [Hk H]]. 排中 (k ∈ n).
    + apply 集族并介入 with n. apply 分离介入...
      apply 序数传递_右弱 with (F k)...
    + apply 集族并介入 with k... apply 分离介入...
  - apply 集族并除去 in H as [k [Hk H]].
    apply 分离之父集 in Hk. apply 集族并介入 with k...
Qed.
```

终于, 我们可以证明无穷层$ε_α⁺$顶ω塔等于无穷层ω顶$ε_α$塔.

**引理** ε'顶ω塔极限等于ω顶ε塔极限: 对任意序数α, ${^{ω}{\stackrel{(ε_α+1)}{ω}}} = {^{ω}{\stackrel{ω}{ε_α}}}$.

证明: 由顶迭代在极限处的定义, 即证

$$\sup\{{^{n}{\stackrel{(ε_α+1)}{ω}}}|n∈ω\} = \sup\{{^{n}{\stackrel{ω}{ε_α}}}|n∈ω\}$$

由上一讲证明的顶迭代的有限递增和有限保序性, 可以使用上面两条引理, 改写目标得

$$\sup\{{^{n⁺}{\stackrel{(ε_α+1)}{ω}}}|n∈ω-1\} = \sup\{{^{n}{\stackrel{ω}{ε_α}}}|n∈ω-1\}$$

由引理"ε'顶ω塔n'层等于ω顶ε塔n层"得证. ∎

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Lemma ε'顶ω塔极限等于ω顶ε塔极限 : ∀α ⋵ ON, (ω ^^ᵀ ω) (ε α)⁺ = (ε α ^^ᵀ ω) ω.
Proof with auto.
  intros. rewrite 顶迭代极限次, 顶迭代极限次...
  rewrite (弱保序无穷序列极限与起始无关 2)... 2: apply 顶迭代有限弱保序...
  rewrite (弱保序无穷序列极限与起始无关 1)... 2: apply 顶迭代有限弱保序...
  simpl. rewrite 弱递增无穷序列极限与起始无关... 2: apply 顶迭代有限弱递增...
  f_equal. apply 替代之外延. intros n Hn. apply 分离除去 in Hn as [Hn Hn'].
  apply ε'顶ω塔n'层等于ω顶ε塔n层... intros H0. apply Hn'. subst...
Qed.
```

最终, 我们可以证明后继ε数等于当前ε数的无穷层指数塔.

**定理** ε_后继_ε塔: 对任意序数α, ${ε_{α⁺}} = {^{ω}{ε_α}}$.

证明: ${ε_{α⁺}} = {^{ω}{\stackrel{(ε_α+1)}{ω}}} = {^{ω}{\stackrel{ω}{ε_α}}} = {^{ω}{ε_α}}$. 其中第3个等号处用了上一讲的引理"无限顶迭代等于左迭代". ∎

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Theorem ε_后继_ε塔 : ∀α ⋵ ON, ε α⁺ = (ε α ^^ᴸ ω).
Proof with auto.
  intros. rewrite ε_后继_ω塔, ε'顶ω塔极限等于ω顶ε塔极限, 无限顶迭代等于左迭代...
  rewrite <- ε数为不动点... apply 幂运算放大...
Qed.
```

## ζ层级

我们继续往上攀爬. 回想之前证明了不动点的枚举也有不动点, 自然而然的想法是考虑ε的不动点.

```Coq
(* Theory/OrdinalOperation.v *)
(* 不动点枚举Section内 *)

Corollary 存在不动点的不动点 : ∀α ⋵ ON, ∃β ⋵ ON, G β = β ∧ α ⋸ β.
Proof. intros. apply 不动点定理; auto. apply 不动点枚举为序数嵌入. Qed.
```

将"不动点的枚举"函数记作 $\mathbf{E}$, "任意不动点"函数记作 $\mathbf{A}$, "序数递归"函数记作 $\mathbf{R}$.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Local Notation E := 不动点枚举.
Local Notation A := 任意不动点.
Local Notation R := 序数递归.
```

**定义** ζ := $\mathbf{E}(ε)$.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Definition ζ := E ε.
```

由构造可知 ζ 是序数嵌入且 $ζ_0≠0$.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Fact ζ为序数嵌入 : 为序数嵌入 ζ.
Proof. apply 不动点枚举为序数嵌入. auto. Qed.
Local Hint Resolve ζ为序数嵌入 : core.

Fact ζ_0不为零 : ζ 0 ≠ 0.
Proof. apply 不动点不为零; auto. Qed.
Local Hint Resolve ζ_0不为零 : core.
```

我们来考察 $ζ_0$ 的值. 从ζ层级开始, 连迭代幂次也够不上了, 不可能给出 $ε_0 = {^ω{ω}}$ 这样的表达式. 我们只能考察 $ζ_0$ 与 ε数的相对关系. 考虑一般性, 我们证明如下相对抽象的定理.

**定理** 最小不动点表达为任意不动点: 对任意序数嵌入$μ$, 若 $ν=\mathbf{E}(μ)$ 且 $ν_0≠0$, 那么 $\mathbf{E}(ν)_0 = \mathbf{A}(ν, ν_0)$.

**例** 令 $μ$ = 幂运算, 那么 $ν=ε$, $\mathbf{E}(ν)=ζ$. 该定理是说

$$ζ_0=\mathbf{A}(ε, ε_0)=\sup\{\mathbf{R}(ε_0,ε)(n)|n∈ω\}$$

证明: 首先, 不难证明 $ν$ 也为序数嵌入, 且$\mathbf{E}(ν)_0$, $ν_0$ 以及 $\mathbf{A}(ν, ν_0)$ 都为序数. 用外延公理.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Theorem 最小不动点表达为任意不动点 : ∀ μ ν, 为序数嵌入 μ →
  ν = E μ → ν ∅ ≠ ∅ → E ν ∅ = A ν (ν ∅).
Proof with auto.
  intros μ ν μ嵌入 不动 H0.
  assert (H1: 为序数嵌入 ν). subst. apply 不动点枚举为序数嵌入...
  assert (H2: E ν ∅ ⋵ ON). rewrite 不动点枚举_0. apply 最小不动点为之...
  assert (H3: ν ∅ ⋵ ON). subst. rewrite 不动点枚举_0. apply 最小不动点为之...
  assert (H4: A ν (ν ∅) ⋵ ON). apply 不动点为之...
  apply 包含的反对称性.
```

- 先证 $\mathbf{E}(ν)_0 ≤ \mathbf{A}(ν, ν_0)$. 由最小不动点的性质, 只需证 $\mathbf{A}(ν, ν_0)$ 是 $ν$ 的不动点, 显然成立.

- 对任意 $x∈\mathbf{A}(ν, ν_0)=\sup\{\mathbf{R}(ν_0,ν)(n)|n∈ω\}$, 存在 $n∈ω$ 使得 $x∈\mathbf{R}(ν_0,ν)(n)$. 要证 $x∈\mathbf{E}(ν)_0$, 只需证 $\mathbf{R}(ν_0,ν)(n) < \mathbf{E}(ν)_0$. 归纳n.

  - 起始阶段, 要证 $\mathbf{R}(ν_0,ν)(0) < \mathbf{E}(ν)_0$, 即证 $ν_0 < \mathbf{E}(ν)_0 = ν_{\mathbf{E}(ν)_0}$, 即证$0<\mathbf{E}(ν)_0$, 由"不动点不为零"得证.
  - 后继阶段, 假设 $\mathbf{R}(ν_0,ν)(n) < \mathbf{E}(ν)_0$, 要证 $\mathbf{R}(ν_0,ν)(n⁺) < \mathbf{E}(ν)_0$, 即证 $ν_{\mathbf{R}(ν_0,ν)(n)} < \mathbf{E}(ν)_0 = ν_{\mathbf{E}(ν)_0}$, 由归纳假设得证. ∎

```Coq
(* 紧接上一段代码 *)

  - apply 小于等于即包含... rewrite 不动点枚举_0.
    apply 最小不动点为之... apply 不动点为之...
  - intros x Hx. apply 集族并除去 in Hx as [n [Hn Hx]].
    apply 序数传递 with (R (ν ∅) ν n)... clear Hx. 归纳 n.
    + rewrite 序数递归_0, <- 不动点枚举枚举之... apply 序数嵌入保序...
      apply 不为零的序数大于零... apply 不动点不为零...
    + rewrite 序数递归_后继, <- 不动点枚举枚举之... apply 序数嵌入保序...
Qed.
```

由此, $ζ_0$ 的值就成了以上定理的一个实例, 即

$$ζ_0=\mathbf{A}(ε, ε_0)=\sup\{\mathbf{R}(ε_0,ε)(n)|n∈ω\} \\ =\sup\{ε_0,ε_{ε_0},ε_{ε_{ε_0}},ε_{ε_{ε_{ε_0}}},...\}$$

其中, 算符 $\mathbf{A}$ 可以直观地看成是这样的操作: 以第2个参数 (例如这里的$ε_0$) 作为初始值, 反复迭代第1个参数所给出的函数 (例如这里的$ε$)


```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Fact ζ_0 : ζ 0 = A ε (ε 0).
Proof. apply 最小不动点表达为任意不动点 with (幂运算 ω); auto. Qed.
```

我们不加证明地列出 $ε_0$ 与 $ζ_0$ 之间的一些极限序数, 以帮助直观感受 $ζ_0$ 有多大. 感兴趣的读者可以自行写Coq代码证明, 当前给出的工具足以完成.

$$ε_1 = \sup\{ε_0 + 1,ω^{ε_0 + 1},ω^{ω^{ε_0 + 1}},...\} = \sup\{ε_0,{ε_0}^{ε_0},{ε_0}^{{ε_0}^{ε_0}},...\}$$

$$ε_2 = \sup\{ε_1 + 1,ω^{ε_1 + 1},ω^{ω^{ε_1 + 1}},...\} = \sup\{ε_1,{ε_1}^{ε_1},{ε_1}^{{ε_1}^{ε_1}},...\}$$

$$ε_3 = \sup\{ε_2 + 1,ω^{ε_2 + 1},ω^{ω^{ε_2 + 1}},...\} = \sup\{ε_0,{ε_2}^{ε_2},{ε_2}^{{ε_2}^{ε_2}},...\}$$

$$ε_ω = \sup\{ε_0,ε_1,ε_2,ε_3,...\}$$

$$ε_{ω^2} = \sup\{ε_ω,ε_{ω⋅2},ε_{ω⋅3},...\}$$

$$ε_{ω^ω} = \sup\{ε_ω,ε_{ω^2},ε_{ω^3},...\}$$

$$ε_{ω^{ω^ω}} = \sup\{ε_{ω^ω},ε_{ω^{ω^2}},ε_{ω^{ω^3}},...\}$$

$$ε_{ε_0} = \sup\{ε_ω,ε_{ω^ω},ε_{ω^{ω^ω}},...\}$$

$$ε_{ε_ω} = \sup\{ε_{ε_0},ε_{ε_1},ε_{ε_2},...\}$$

$$ε_{ε_{ε_0}} = \sup\{ε_{ε_ω},ε_{ε_{ω^ω}},ε_{ε_{ω^{ω^ω}}},...\}$$

而 $ζ_0$ 大幅超越以上所有序数.

$$ζ_0=\sup\{ε_0,ε_{ε_0},ε_{ε_{ε_0}},ε_{ε_{ε_{ε_0}}},...\}$$

继续往上, 我们有 $ζ$ 在后继处的值. 由构造

$$ζ_{α⁺}=\mathbf{A}(ε, ζ_α+1)=\sup\{\mathbf{R}(ζ_α+1,ε)(n)|n∈ω\} \\ =\sup\{ζ_α+1,ε_{ζ_α+1},ε_{ε_{ζ_α+1}},ε_{ε_{ε_{ζ_α+1}}},...\}$$

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Fact ζ_后继 : ∀α ⋵ ON, ζ α⁺ = A ε (ζ α)⁺.
Proof. intros. unfold ζ. rewrite 不动点枚举_后继; auto. Qed.
```

例如 $ζ_{1}=\sup\{ζ_0+1,ε_{ζ_0+1},ε_{ε_{ζ_0+1}},ε_{ε_{ε_{ζ_0+1}}},...\}$.

而极限处有 $ζ_λ = \sup\{ζ_α|α∈λ\}$.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Fact ζ_极限 : 极限处连续 ζ.
Proof. apply 不动点枚举_极限. Qed.
```

例如 $ζ_ω = \sup\{ζ_0,ζ_1,ζ_2,ζ_3,...\}$.

总之, 我们有

$$
  \begin{aligned}
  ζ_0 & = \mathbf{A}(ε, ε_0) \\
  ζ_{α⁺} & = \mathbf{A}(ε, ζ_α+1) \\
  ζ_λ & = \sup\{ζ_α|α∈λ\}
  \end{aligned}
$$

## η层级

从 $ζ_ω$ 再往上还有

$$ζ_{ε_0} = \sup\{ζ_ω,ζ_{ω^ω},ζ_{ω^{ω^ω}},...\}$$

$$ζ_{ζ_0} = \sup\{ζ_{ε_0},ζ_{ε_{ε_0}},ζ_{ε_{ε_{ε_0}}},...\}$$

直到η层级

$$η_0=\sup\{ζ_0,ζ_{ζ_0},ζ_{ζ_{ζ_0}},ζ_{ζ_{ζ_{ζ_0}}},...\}$$

形式化地

**定义** η := $\mathbf{E}(ζ)$.

由构造可知 η 是序数嵌入且 $η_0≠0$.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Definition η := E ζ.

Fact η为序数嵌入 : 为序数嵌入 η.
Proof. apply 不动点枚举为序数嵌入. auto. Qed.

Fact η_0不为零 : η 0 ≠ 0.
Proof. apply 不动点不为零; auto. Qed.
```

而η在零, 后继, 以及非零极限处的值由下式给出.

```Coq
(* LargeOrdinals/EpsilonNumbers.v *)

Fact η_0 : η 0 = A ζ (ζ 0).
Proof. apply 最小不动点表达为任意不动点 with ε; auto. Qed.

Fact η_后继 : ∀α ⋵ ON, η α⁺ = A ζ (η α)⁺.
Proof. intros. unfold η. rewrite 不动点枚举_后继; auto. Qed.

Fact η_极限 : 极限处连续 η.
Proof. apply 不动点枚举_极限. Qed.
```

即

$$
  \begin{aligned}
  η_0 & = \mathbf{A}(ζ, ζ_0) \\
  η_{α⁺} & = \mathbf{A}(ζ, η_α+1) \\
  η_λ & = \sup\{η_α|α∈λ\}
  \end{aligned}
$$

从 $η_0$ 往上, 我们有

$$η_{1}=\sup\{η_0+1,ζ_{η_0+1},ζ_{ζ_{η_0+1}},ζ_{ζ_{ζ_{η_0+1}}},...\}$$

$$η_ω = \sup\{η_0,η_1,η_2,η_3,...\}$$

$$η_{ε_0} = \sup\{η_ω,η_{ω^ω},η_{ω^{ω^ω}},...\}$$

$$η_{ζ_0} = \sup\{η_{ε_0},η_{ε_{ε_0}},η_{ε_{ε_{ε_0}}},...\}$$

$$η_{η_0} = \sup\{η_{ζ_0},η_{ζ_{ζ_0}},η_{ζ_{ζ_{ζ_0}}},...\}$$

直到

$$\mathbf{E}(η)_0=\sup\{η_0,η_{η_0},η_{η_{η_0}},η_{η_{η_{η_0}}},...\}$$

符号是有限的, 我们不可能一直命名下去. 将ε, ζ, η分别看作第1, 2, 3层级, 我们将在下一讲将其推广到任意序数层级.
