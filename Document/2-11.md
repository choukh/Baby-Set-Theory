#! https://zhuanlan.zhihu.com/p/442886905
# Coq集合论讲座 (2-11: 迭代幂次)

> [GitHub - choukh/Baby-Set-Theory](https://github.com/choukh/Baby-Set-Theory)  
> Q群: 893531731

本文是Coq集合论讲座第2季第11讲. 上一讲: [Coq集合论讲座 (2-10：不动点的枚举，加法与乘法不动点)](https://zhuanlan.zhihu.com/p/439161308)

为了构造比 $ω^ω$, $ω^{ω^ω}$, ... 等更大的序数——ε数, 我们已经准备好了新的工具——Veblen不动点. 进入构造之前, 我们再换一个角度理解该工具的必要性.

首先回顾一路走来的历程, 我们从后继开始, 通过序数递归, 定义了加法, 乘法和幂运算. 如果把后继视作0级运算, 那么加法, 乘法和幂运算分别是第1, 2, 3级运算. 可以看到, n⁺级运算是n级运算的递归.

```Coq
(* Arith/Ord.v *)

Definition 加法 := λ α, 序数递归 α 后继.
Definition 乘法 := λ α, 序数递归 0 (λ ξ, ξ + α).
Definition 幂运算 := λ α, 缺零递归 1 (λ ξ, ξ * α).
```

此外, 我们特别注意了乘法和幂运算的定义方式, 使用了严格递增的右侧运算, 使之成为序数嵌入. 由于左侧运算不是严格递增, 无法形成序数嵌入.

```Coq
(* Arith/Ord.v *)

Lemma 加法放大 : ∀ α β ⋵ ON, β ≠ 0 → α ∈ α + β.
Lemma 乘法放大 : ∀ α β ⋵ ON, α ≠ 0 → 1 ∈ β → α ∈ α * β.

Lemma 加法弱放大 : ∀ α β ⋵ ON, α ⋸ β + α.
Lemma 乘法弱放大 : ∀ α β ⋵ ON, β ≠ 0 → α ⋸ β * α.
```

为了构造更大的序数, 一个自然而然的想法是, 我们应该继续这个进程, 定义第4级运算. 但是, 我们接下来将证明, 第4级运算无法形成序数嵌入, 无论使用左侧幂运算还是右侧幂运算定义. 在前几讲中, 我们已经感受到了序数嵌入所具有的良好性质, 没有它们我们将寸步难行. 幸运的是, 在[2-9](https://zhuanlan.zhihu.com/p/432777891)我们证明了不动点的枚举是序数嵌入.

```Coq
Theorem 不动点枚举为序数嵌入 : ∀ F, 为序数嵌入 F → 为序数嵌入 (不动点枚举 F).
```

这就是我们不再定义更高级的运算, 转而使用不动点工具的原因. 尽管如此, 我们还是把第4级定义出来, 一方面为了展示它不是序数嵌入, 一方面有助于理解ε数. 第4级运算一般称为迭代幂次, 我们分别考察使用左侧幂运算和右侧幂运算定义的情况.

## 左迭代幂次

**定义** 左迭代幂次: 左侧幂运算的递归, 记作 $^{β}α$, 即

$$
  ^{β}α := \left.α^{α^{...^α}}\right\}β⁺个α
$$

```Coq
(* Arith/Tetration.v *)

Definition 左迭代 := λ α, 序数递归 α (幂运算 α).
Notation "α ^^ᴸ β" := (左迭代 α β) (at level 25) : 序数算术域.
```

可以证明, 左迭代幂次为序数运算, 且满足

$$
  \begin{aligned}
  ^{0}α & = α \\
  ^{β⁺}α & = α^{^{β}α} \\
  ^{λ}α & = \sup\{^{β}α|β∈λ\}
  \end{aligned}
$$

```Coq
(* Arith/Tetration.v *)

Theorem 左迭代为序数运算 : ∀ α β ⋵ ON, α ^^ᴸ β ⋵ ON.
Proof. intros. apply 序数运算的递归为序数运算; auto. Qed.
Local Hint Resolve 左迭代为序数运算 : core.

Theorem 左迭代零次 : ∀α ⋵ ON, α ^^ᴸ 0 = α.
Proof. intros. apply 序数递归_0; auto. Qed.

Theorem 左迭代后继次 : ∀ α β ⋵ ON, α ^^ᴸ β⁺ = α ^ (α ^^ᴸ β).
Proof. intros. apply 序数递归_后继; auto. Qed.

Theorem 左迭代极限次 : ∀α ⋵ ON, 极限处连续 (左迭代 α).
Proof. intros. apply 序数递归_极限; auto. Qed.
```

**定义** 我们说函数F有限递增, 当且仅当对任意自然数n有 $F(n) < F(n⁺)$.

**定义** 我们说函数F有限保序, 当且仅当对任意自然数 $m < n$ 有 $F(m) < F(n)$.

```Coq
(* Theory/OrdinalOperation.v *)

Notation 有限递增 F := (∀n ∈ ω, F n ∈ F n⁺).
Notation 有限保序 F := (∀n ∈ ω, ∀m ∈ n, F m ∈ F n).
```

**引理** 左迭代有限递增: 对任意大于1的序数α和任意自然数n有 $^{n}α < {^{n⁺}α}$.

证明: 归纳n. 起始阶段, 要证 $^{0}α < {^{1}α}$, 即证 $α < α^α$. 由于幂运算在右侧严格放大, 所以成立. 归纳阶段, 假设 $^{n}α < {^{n⁺}α}$, 要证 $^{n⁺}α < {^{n⁺⁺}α}$, 即证 $α^{^{n}α} < α^{^{n⁺}α}$. 由幂运算的保序性和归纳假设得证. ∎

```Coq
(* Arith/Tetration.v *)

Lemma 左迭代有限递增 : ∀α ⋵ ON, 1 ∈ α → 有限递增 (左迭代 α).
Proof with auto.
  intros α Hα H1 n Hn. 归纳 n.
  - rewrite 左迭代后继次, 左迭代零次... apply 幂运算放大...
  - rewrite 左迭代后继次, 左迭代后继次... apply 幂运算保序...
Qed.
```

**事实** 左迭代有限保序: 对任意大于1的序数α和任意自然数 $m < n$ 有 $^{m}α < {^{n}α}$.

证明: 归纳n. 起始阶段, $m < 0$, 跳过. 归纳阶段, 假设 $m < n$ 有 $^{m}α < {^{n}α}$, 要证 $m < n⁺$ 有 $^{m}α < {^{n⁺}α}$.
- 若$m < n$, $^{m}α < {^{n}α} < {^{n⁺}α}$.
- 若$m = n$, $^{m}α = {^{n}α} < {^{n⁺}α}$. ∎


```Coq
(* Arith/Tetration.v *)

Fact 左迭代有限保序 : ∀α ⋵ ON, 1 ∈ α → 有限保序 (左迭代 α).
Proof with auto.
  intros α Hα H1 n Hn m. 归纳 n; intro Hmn. 空集归谬.
  apply 后继除去 in Hmn as [].
  - apply 序数传递 with (α ^^ᴸ n)... apply 左迭代有限递增...
  - subst. apply 左迭代有限递增...
Qed.
```

**引理** 左迭代ω次为极限: 对任意大于1的序数α, $^ω{α}$为极限.

证明: 只需证 $⋃{^ω{α}} = {^ω{α}}$, 即证

$$
  ⋃\sup\{^β{α}|β∈ω\} = \sup\{^β{α}|β∈ω\}
$$

用外延公理.
- 对任意$x∈⋃\sup\{^β{α}|β∈ω\}$, 存在 $β∈\sup\{^β{α}|β∈ω\}$ 使得 $x∈β$, 且存在 $n∈ω$ 使得 $β∈{^n{α}}$. 由传递性有 $x∈{^n{α}}$, 结合 $n∈ω$ 即得 $x∈\sup\{^β{α}|β∈ω\}$.

```Coq
(* Arith/Tetration.v *)

Lemma 左迭代ω次为极限 : ∀α ⋵ ON, 1 ∈ α → α ^^ᴸ ω ⋵ LIM.
Proof with auto.
  intros α Hα H1. split... rewrite 左迭代极限次... 外延.
  - apply 并集除去 in H as [β [Hβ H]].
    apply 集族并除去 in Hβ as [n [Hn Hβ]].
    apply 集族并介入 with n... apply 序数传递 with β...
```

- 对任意$x∈\sup\{^β{α}|β∈ω\}$, 存在 $n∈ω$ 使得 $x∈{^n{α}}$. 由"左迭代有限递增"有 ${^n{α}}∈{^n⁺{α}}$, 结合 $n⁺∈ω$ 有 ${^n{α}}∈\sup\{^β{α}|β∈ω\}$. 又 $x∈{^n{α}}$, 所以 $x∈⋃\sup\{^β{α}|β∈ω\}$. ∎

```Coq
(* 紧接上一段代码 *)

  - apply 集族并除去 in H as [n [Hn H]].
    apply 并集介入 with (α ^^ᴸ n)...
    apply 集族并介入 with n⁺. apply 极限序数有其任意元素的后继...
    apply 左迭代有限递增...
Qed.
```

**引理** 仅零之左迭代为零: 对任意序数α β, 如果 $^β{α} = 0$, 那么 $α = 0$.

证明: 超限归纳β, 有归纳假设 $∀γ ∈ β, {^γ{α}} = 0 → α = 0$. 讨论β.

- 若为零, ${^0{α}} = α = 0$.
- 若为后继, ${^β⁺{α}} = α^{^β{α}} = 0$, 所以 $α = 0$.
- 若为非零极限, ${^β{α}} = \sup\{^γ{α}|γ∈β\} = 0$. 由"集族并为零"有 $∀γ ∈ β, {^γ{α}} = 0$，由归纳假设即得$α = 0$. ∎

```Coq
(* Arith/Tetration.v *)

Lemma 仅零之左迭代为零 : ∀ α β ⋵ ON, α ^^ᴸ β = 0 → α = 0.
Proof with eauto.
  intros α Hα. 超限归纳 β Hβ. 超限讨论 β; intros Heq.
  - rewrite 左迭代零次 in Heq...
  - rewrite 左迭代后继次 in Heq... apply 幂为零 in Heq...
  - rewrite 左迭代极限次 in Heq... apply 集族并为零 in Heq as []... exfalso...
Qed.
```

**引理** 左迭代在ω后继处不递增: 对任意大于1的序数α, $^ω⁺{α} = {^ω{α}}$.

证明: 由以上两条引理可知 $^ω{α}$ 为非零极限. 左边 = $α^{^ω{α}}$ = $\sup\{α^{β}|β∈{^ω{α}}\}$ = $\sup\{α^{β}|β∈\sup\{^n{α}|n∈ω\}\}$. 右边 = $\sup\{^n{α}|n∈ω\}\}$. 用外延公理左边等于右边.

```Coq
(* Arith/Tetration.v *)

Lemma 左迭代在ω后继处不递增 : ∀α ⋵ ON, 1 ∈ α → α ^^ᴸ ω⁺ = α ^^ᴸ ω.
Proof with auto.
  intros α Hα H1. rewrite 左迭代后继次, 极限次幂, 左迭代极限次...
  2: apply 左迭代ω次为极限...
  2: { intros H. apply 仅零之左迭代为零 in H... apply 大于一的序数不为零 with α... }
  外延.
```

- 对任意 $x∈\sup\{α^{β}|β∈\sup\{^n{α}|n∈ω\}\}$, 存在 $β∈\sup\{^n{α}|n∈ω\}$ 使得 $x∈α^{β}$, 且存在 $n∈ω$ 使得 $β∈{^n{α}}$. 要证 $x∈\sup\{^n{α}|n∈ω\}\}$, 由 $n⁺∈ω$ 只需证 $x∈{^n⁺{α}} = α^{^n{α}}$. 由传递性只需证 $α^{β}∈α^{^n{α}}$, 由幂运算的保序性和 $β∈{^n{α}}$ 即证.

```Coq
(* 紧接上一段代码 *)

  - apply 集族并除去 in H as [β [Hβ Hx]].
    apply 集族并除去 in Hβ as [n [Hn Hβ]].
    apply 集族并介入 with n⁺... apply 序数传递 with (α ^ β)...
    rewrite 左迭代后继次... apply 幂运算保序...
```

- 对任意 $x∈\sup\{^n{α}|n∈ω\}$, 存在 $n∈ω$ 使得 $x∈{^n{α}}$. 要证 $x∈\sup\{α^{β}|β∈\sup\{^n{α}|n∈ω\}\}$, 只需证 $^n{α}∈\sup\{^n{α}|n∈ω\}$ 且 $x∈α^{^n{α}}$. 对于前者, 由 $n⁺∈ω$ 且 $^n{α}∈{^n⁺{α}}$ 得证. 对于后者, 即证 $x∈{^n⁺{α}}$, 由传递性和 $^n{α}∈{^n⁺{α}}$ 得证. ∎

```Coq
(* 紧接上一段代码 *)

  - apply 集族并除去 in H as [n [Hn Hx]].
    apply 集族并介入 with (α ^^ᴸ n).
    apply 集族并介入 with n⁺... apply 左迭代有限递增...
    apply 序数传递 with (α ^^ᴸ n)... rewrite <- 左迭代后继次... apply 左迭代有限递增...
Qed.
```

**定理** 左迭代在ω次之后不变: 对任意大于1的序数α和任意大于ω的序数β, $^β{α}={^ω{α}}$.

证明: 超限归纳β, 有归纳假设 $∀γ∈β,ω∈γ→{^γ{α}}={}^ω{α}$. 讨论β. β不可能为零.

- 若为后继, 有前提 $ω∈β⁺$.
  - 若 $ω∈β$, ${^β⁺{α}}=α^{^β{α}}=α^{^ω{α}}={^ω⁺{α}}={^ω{α}}$. 其中第二个等号用了归纳假设, 第四个等号用了"左迭代在ω后继处不递增".
  - 若 $ω=β$, ${^β⁺{α}}={^ω⁺{α}}={^ω{α}}$.

```Coq
(* Arith/Tetration.v *)

Theorem 左迭代在ω次之后不变 : ∀α ⋵ ON, 1 ∈ α → ∀β ⋵ ON, ω ∈ β → α ^^ᴸ β = α ^^ᴸ ω.
Proof with auto.
  intros α Hα H1. 超限归纳 β; intros H. 超限讨论 β. 空集归谬.
  - apply 后继除去 in H as []...
    + rewrite 左迭代后继次, 归纳假设, <- 左迭代后继次, 左迭代在ω后继处不递增...
    + subst... apply 左迭代在ω后继处不递增...
```

- 若为非零极限, 要证 $\sup\{^γ{α}|γ∈β\} = {^ω{α}}$. 用外延公理.
  - 对任意 $x∈{^ω{α}}$, 由 $ω∈β$, 即得 $x∈\sup\{^γ{α}|γ∈β\}$.
  - 对任意 $x∈\sup\{^γ{α}|γ∈β\}$, 存在 $γ∈β$ 使得 $x∈{^γ{α}}$.
    - 若 $γ=ω$, 那么 $x∈{^ω{α}}$.
    - 若 $ω∈γ$, 由归纳假设得 $x∈{^γ{α}}={^ω{α}}$.
    - 若 $γ∈ω$, 由传递性只需证 ${^γ{α}}∈{^ω{α}}$, 即证 ${^γ{α}}∈\sup\{^n{α}|n∈ω\}$. 由 $γ⁺∈ω$ 以及 ${^γ{α}}∈{^γ⁺{α}}$ 得证. ∎

```Coq
(* 紧接上一段代码 *)

  - rewrite 左迭代极限次... 外延. 2: apply 集族并介入 with ω...
    apply 集族并除去 in H2 as [γ [Hγ Hx]]. assert (Hγo: γ ⋵ ON). eauto.
    destruct (序数三歧 γ Hγo ω) as [|[]]... subst... 2: rewrite <- (归纳假设 γ)...
    apply 序数传递 with (α ^^ᴸ γ)... rewrite (左迭代极限次 α Hα ω)...
    apply 集族并介入 with γ⁺... apply 左迭代有限递增...
Qed.
```

直观上, 当 $α^{α^{α^{...}}}$ 达到无穷层时, 其值就已固定, 即时提升到任意超穷层, 也不能使之增大. 所以左迭代幂次不是序数嵌入. 我们接着考察右迭代幂次.

## 右迭代幂次

**定义** 右迭代幂次: 右侧幂运算的递归, 在本小节中姑且记作 $^{β}α$. 我们将证明它是平凡的, 本小节结束后我们不会再使用它.

$$
  ^{β}α := \overbrace{(...((α^α)^α)^{...})^α}^{β⁺个α}
$$

```Coq
(* Arith/Tetration.v *)

Definition 右迭代 := λ α, 序数递归 α (λ ξ, ξ ^ α).
Notation "α ^^ᴿ β" := (右迭代 α β) (at level 25) : 序数算术域.
```

可以证明, 右迭代幂次为序数运算, 且满足

$$
  \begin{aligned}
  ^{0}α & = α \\
  ^{β⁺}α & = (^{β}α)^α \\
  ^{λ}α & = \sup\{^{β}α|β∈λ\}
  \end{aligned}
$$

```Coq
(* Arith/Tetration.v *)

Theorem 右迭代为序数运算 : ∀ α β ⋵ ON, α ^^ᴿ β ⋵ ON.
Proof. intros. apply 序数运算的递归为序数运算; auto. Qed.
Local Hint Resolve 右迭代为序数运算 : core.

Theorem 右迭代零次 : ∀α ⋵ ON, α ^^ᴿ 0 = α.
Proof. intros. apply 序数递归_0; auto. Qed.

Theorem 右迭代后继次 : ∀ α β ⋵ ON, α ^^ᴿ β⁺ = (α ^^ᴿ β) ^ α.
Proof. intros. apply 序数递归_后继; auto. Qed.

Theorem 右迭代极限次 : ∀α ⋵ ON, 极限处连续 (右迭代 α).
Proof. intros. apply 序数递归_极限; auto. Qed.
```

**引理** 右迭代于一: 对任意序数α有 $^{α}1 = 1$.

证明: 直观上是显然的. 严格证明必须用超限归纳法. 对α归纳, 有归纳假设 $∀β∈α,{^{β}1}=1$. 讨论β.

- 若为零, $^{0}1 = 1$.
- 若为后继, $^{β⁺}1 = (^{β}1)^1 = {^{β}1} = 1$.
- 若为非零极限, 要证 $\sup\{^{β}1|β∈α\} = 1$. 用外延公理.
  - 对任意 $x∈\sup\{^{β}1|β∈α\}$, 存在 $β∈α$ 使得 $x∈{^{β}1}$. 由归纳假设, $x∈{^{β}1}=1$.
  - 对任意 $x∈1$, 有 $x∈1={^{0}1}∈\sup\{^{β}1|β∈α\}$. ∎

```Coq
(* Arith/Tetration.v *)

Lemma 右迭代于一 : ∀α ⋵ ON, 1 ^^ᴿ α = 1.
Proof with auto.
  超限归纳. 超限讨论 α.
  - rewrite 右迭代零次...
  - rewrite 右迭代后继次, 一次幂...
  - rewrite 右迭代极限次... 外延.
    + apply 集族并除去 in H as [β [Hβ H]]. rewrite 归纳假设 in H...
    + simpl in H. apply 后继除去 in H as []... 空集归谬. subst.
      apply 集族并介入 with ∅... rewrite 右迭代零次... simpl...
Qed.
```

**定理** 右迭代化简: 对任意非零序数α和任意序数β, ${^{β}α}=α^{α^β}$.

证明: 若$α=1$, 有 ${^{β}1}=1=1^{1^β}$, 证毕. 若$α > 1$, 超限归纳β, 有归纳假设$∀γ∈β,{^{γ}α}=α^{α^γ}$. 讨论β.

- 若为零, 左边 = ${^{0}α}=α$, 右边 = $α^{α^0}=α^{1}=α$.
- 若为后继, 左边 = ${^{β⁺}α}=(^{β}α)^α=(α^{α^β})^α=α^{α^β⋅α}=α^{α^{β⁺}}$.
- 若为非零极限, 即证 $\sup\{^{γ}α|γ∈β\}=\sup\{α^γ|γ∈α^β\}$. 用外延公理.

```Coq
(* Arith/Tetration.v *)

Theorem 右迭代化简 : ∀ α β ⋵ ON, α ≠ 0 → α ^^ᴿ β = α ^ (α ^ β).
Proof with auto.
  intros α Hα.
  排中 (α = 1) as [|H1]. {
    intros β Hβ H1. subst. rewrite 右迭代于一, 底数为一的幂...
  }
  超限归纳 β Hβ. intros Hα0. 超限讨论 β.
  - rewrite 右迭代零次, 零次幂, 一次幂...
  - rewrite 右迭代后继次, 归纳假设, <- 指数积运算律, 后继次幂...
  - rewrite 右迭代极限次, 极限次幂...
    2: apply 幂为极限_右...
    2: intros H; apply 幂为零 in H...
    外延.
```

  - 对任意 $x∈\sup\{^{γ}α|γ∈β\}$, 存在 $γ∈β$ 使得 $x∈{^{γ}α}=α^{α^γ}$. 由幂运算的保序性, $α^γ∈α^β$, 所以 $x∈\sup\{α^γ|γ∈α^β\}$.
  - 对任意 $x∈\sup\{α^γ|γ∈α^β\}$, 存在 $γ∈α^β$ 使得 $x∈α^γ$. 又 $γ∈α^β=\sup\{α^δ|δ∈β\}$, 存在 $δ∈β$ 使得 $γ∈α^δ$. 由幂运算的保序性, $x∈α^γ∈α^{α^δ}={^δ{α}}$, 所以 $x∈\sup\{^{γ}α|γ∈β\}$. ∎

```Coq
(* 紧接上一段代码 *)

    + apply 集族并除去 in H as [γ [Hγ H]]. assert (Hγo: γ ⋵ ON). eauto.
      apply 集族并介入 with (α ^ γ)... apply 幂运算保序... rewrite <- 归纳假设...
    + apply 集族并除去 in H as [γ [Hγ Hx]]. rewrite 极限次幂 in Hγ...
      apply 集族并除去 in Hγ as [δ [Hδ Hγ]].
      assert (Hγo: γ ⋵ ON). eauto.
      assert (Hoδ: δ ⋵ ON). eauto.
      apply 集族并介入 with δ... rewrite 归纳假设...
      apply 序数传递 with (α ^ γ)... apply 幂运算保序...
Qed.
```

可见, 右迭代幂次只不过是两层的幂运算而已, 完全没有我们所期待的大幅度增长率提升. 总之, 左迭代有天花板, 右迭代很弱, 这就是我们在第3级运算之后转而使用不动点的原因.

本讲最后再补充一个称为"顶迭代"的概念, 它将在下一讲帮助理解ε数.

## 顶迭代幂次

**定义** 顶迭代幂次: 左侧幂运算的**指定初值**的递归, 记作 $^β{\stackrel{\text{τ}}{α}}$, 即

$$
  ^β{\stackrel{\text{τ}}{α}} := \left.α^{α^{...α^{τ}}}\right\}β个α
$$

```Coq
(* Arith/Tetration.v *)

(* α ^ α ^ ... ^ α ^ τ *)
Definition 顶迭代 := λ α β τ, 序数递归 τ (幂运算 α) β.
Notation "α ^^ᵀ β" := (顶迭代 α β) (at level 25) : 序数算术域.
```

可以证明, 顶迭代幂次为序数运算, 且满足

$$
  \begin{aligned}
  ^0{\stackrel{\text{τ}}{α}} & = τ \\
  ^{β⁺}{\stackrel{\text{τ}}{α}} & = α^{^{β}{\stackrel{\text{τ}}{α}}} \\
  ^{λ}α & = \sup\{^{β}{\stackrel{\text{τ}}{α}}|β∈λ\}
  \end{aligned}
$$

```Coq
(* Arith/Tetration.v *)

Theorem 顶迭代为序数运算 : ∀ τ α β ⋵ ON, (α ^^ᵀ β) τ ⋵ ON.
Proof. intros. apply 序数运算的递归为序数运算; auto. Qed.
Local Hint Resolve 顶迭代为序数运算 : core.

Theorem 顶迭代零次 : ∀ τ α ⋵ ON, (α ^^ᵀ 0) τ = τ.
Proof. intros. apply 序数递归_0; auto. Qed.

Theorem 顶迭代后继次 : ∀ τ α β ⋵ ON, (α ^^ᵀ β⁺) τ = α ^ (α ^^ᵀ β) τ.
Proof. intros. apply 序数递归_后继; auto. Qed.

Theorem 顶迭代极限次 : ∀ τ α ⋵ ON, 极限处连续 (λ β, (α ^^ᵀ β) τ).
Proof. intros. apply 序数递归_极限; auto. Qed.
```

**定义** 我们说函数F有限弱递增, 当且仅当对任意自然数n有 $F(n) ≤ F(n⁺)$.

**定义** 我们说函数F有限弱保序, 当且仅当对任意自然数 $m < n$ 有 $F(m) ≤ F(n)$.

```Coq
(* Theory/OrdinalOperation.v *)

Notation 有限弱递增 F := (∀n ∈ ω, F n ⋸ F n⁺).
Notation 有限弱保序 F := (∀n ∈ ω, ∀m ∈ n, F m ⋸ F n).
```

**引理** 顶迭代有限弱递增: 对任意序数τ, 任意大于1的序数α和任意自然数n有 $^n{\stackrel{\text{τ}}{α}} ≤ {^{n⁺}{\stackrel{\text{τ}}{α}}}$.

证明: 归纳n. 起始阶段, 要证 $^0{\stackrel{\text{τ}}{α}} ≤ {^{1}{\stackrel{\text{τ}}{α}}}$, 即证 $τ≤α^τ$. 由于幂运算在左侧弱放大, 所以成立. 归纳阶段, 假设 $^{n}{\stackrel{\text{τ}}{α}} ≤ {^{n⁺}{\stackrel{\text{τ}}{α}}}$, 要证 $^{n⁺}{\stackrel{\text{τ}}{α}} ≤ {^{n⁺⁺}{\stackrel{\text{τ}}{α}}}$, 即证 $α^{^{n}{\stackrel{\text{τ}}{α}}} ≤ α^{^{n⁺}{\stackrel{\text{τ}}{α}}}$. 由幂运算的保序性和归纳假设得证. ∎

```Coq
(* Arith/Tetration.v *)

Lemma 顶迭代有限弱递增 : ∀ τ α ⋵ ON, 1 ∈ α → 有限弱递增 (λ k, (α ^^ᵀ k) τ).
Proof with auto.
  intros τ Hτ α Hα H1 n Hn. 归纳 n.
  - rewrite 顶迭代零次, 顶迭代一次... apply 幂运算弱放大...
  - rewrite 顶迭代后继次, 顶迭代后继次... apply 幂运算保序_弱右...
Qed.
```

**事实** 顶迭代有限弱保序: 对任意序数τ, 任意大于1的序数α和任意自然数 $m < n$ 有 $^{m}{\stackrel{\text{τ}}{α}} ≤ {^{n}{\stackrel{\text{τ}}{α}}}$.

证明: 归纳n. 起始阶段, $m < 0$, 跳过. 归纳阶段, 假设 $m < n$ 有 $^{m}{\stackrel{\text{τ}}{α}} ≤ {^{n}{\stackrel{\text{τ}}{α}}}$, 要证 $m < n⁺$ 有 $^{m}{\stackrel{\text{τ}}{α}} ≤ {^{n⁺}{\stackrel{\text{τ}}{α}}}$.
- 若$m < n$, $^{m}{\stackrel{\text{τ}}{α}} ≤ {^{n}{\stackrel{\text{τ}}{α}}} ≤ {^{n⁺}{\stackrel{\text{τ}}{α}}}$.
- 若$m = n$, $^{m}{\stackrel{\text{τ}}{α}} = {^{n}{\stackrel{\text{τ}}{α}}} ≤ {^{n⁺}{\stackrel{\text{τ}}{α}}}$. ∎


```Coq
(* Arith/Tetration.v *)

Fact 顶迭代有限弱保序 : ∀ τ α ⋵ ON, 1 ∈ α → 有限弱保序 (λ k, (α ^^ᵀ k) τ).
Proof with auto.
  intros τ Hτ α Hα H1 n Hn m. 归纳 n; intro Hmn. 空集归谬.
  apply 后继除去 in Hmn as [].
  - apply 序数传递_弱 with ((α ^^ᵀ n) τ)... apply 顶迭代有限弱递增...
  - subst. apply 顶迭代有限弱递增...
Qed.
```

可以证明, 对任意$τ < α$ 有 ${^{n}{\stackrel{\text{τ}}{α}}} < {^{n}α} < {^{n⁺}{\stackrel{\text{τ}}{α}}}$. 我们分两部分证.

**引理** 有限顶迭代小于左迭代: 对任意序数τ, 任意大于1的序数α, 如果$τ < α$, 那么 ${^{n}{\stackrel{\text{τ}}{α}}} < {^{n}α}$.

证明: 归纳n. 起始阶段, 要证 ${^{0}{\stackrel{\text{τ}}{α}}} < {^{0}α}$, 即证 $τ < α$, 此即前提. 归纳阶段, 假设 ${^{n}{\stackrel{\text{τ}}{α}}} < {^{n}α}$, 要证 ${^{n⁺}{\stackrel{\text{τ}}{α}}} < {^{n⁺}α}$, 即证 $α^{^{n}{\stackrel{\text{τ}}{α}}} < α^{^n{α}}$, 由幂运算的保序性和归纳假设得证. ∎

```Coq
(* Arith/Tetration.v *)

Lemma 有限顶迭代小于左迭代 : ∀α ⋵ ON, 1 ∈ α → ∀τ ∈ α, ∀n ∈ ω, (α ^^ᵀ n) τ ∈ α ^^ᴸ n.
Proof with auto.
  intros α Hα H1 τ Hτα n Hn.
  assert (Hτ: τ ⋵ ON). eauto.
  归纳 n.
  - rewrite 顶迭代零次, 左迭代零次...
  - rewrite 顶迭代后继次, 左迭代后继次... apply 幂运算保序...
Qed.
```

**引理** 有限左迭代小于后继顶迭代: 对任意大于1的序数τ, 任意序数α, 如果$τ < α$, 那么 ${^{n}α} < {^{n⁺}{\stackrel{\text{τ}}{α}}}$.

证明: 归纳n. 起始阶段, 要证 ${^{0}α} < {^{1}{\stackrel{\text{τ}}{α}}}$, 即证 $α < α^τ$, 由"幂运算放大"得证. 归纳阶段, 假设 ${^{n}α} < {^{n⁺}{\stackrel{\text{τ}}{α}}}$, 要证 ${^{n⁺}α} < {^{n⁺⁺}{\stackrel{\text{τ}}{α}}}$, 即证 $α^{^n{α}} < α^{^{n⁺}{\stackrel{\text{τ}}{α}}}$, 由幂运算的保序性和归纳假设得证. ∎

```Coq
(* Arith/Tetration.v *)

Lemma 有限左迭代小于后继顶迭代 : ∀α ⋵ ON, ∀τ ∈ α, 1 ∈ τ → ∀n ∈ ω, α ^^ᴸ n ∈ (α ^^ᵀ n⁺) τ.
Proof with auto.
  intros α Hα τ Hτα H1 n Hn.
  assert (Hτ: τ ⋵ ON). eauto.
  assert (H1α: 1 ∈ α). apply 序数传递 with τ...
  归纳 n.
  - rewrite 顶迭代一次, 左迭代零次... apply 幂运算放大...
  - rewrite 顶迭代后继次, 左迭代后继次... apply 幂运算保序...
Qed.
```

结合以上两条引理, 可以证明左侧幂运算的递归的极限不在意初始值.

**定理** 无限顶迭代等于左迭代: 对任意大于1的序数τ, 任意序数α, 如果$τ < α$, 那么 ${^{ω}{\stackrel{\text{τ}}{α}}} = {^{ω}α}$.

证明: 即证 $\sup\{{^{n}{\stackrel{\text{τ}}{α}}}|n∈ω\} = \sup\{{^{n}α}|n∈ω\}$. 用外延公理.

- 对任意$x∈\sup\{{^{n}{\stackrel{\text{τ}}{α}}}|n∈ω\}$, 存在 $n∈ω$ 使得 $x∈{^{n}{\stackrel{\text{τ}}{α}}}∈{^{n}α}$, 所以$x∈\sup\{{^{n}α}|n∈ω\}$.

- 对任意$x∈\sup\{{^{n}α}|n∈ω\}$, 存在 $n∈ω$ 使得 $x∈{^{n}α}∈{^{n⁺}{\stackrel{\text{τ}}{α}}}$, 又$n⁺∈ω$, 所以$x∈\sup\{{^{n}{\stackrel{\text{τ}}{α}}}|n∈ω\}$. ∎

```Coq
(* Arith/Tetration.v *)

Theorem 无限顶迭代等于左迭代 : ∀α ⋵ ON, ∀τ ∈ α, 1 ∈ τ → (α ^^ᵀ ω) τ = α ^^ᴸ ω.
Proof with auto.
  intros α Hα τ Hτα H1.
  assert (Hτ: τ ⋵ ON). eauto.
  assert (H1α: 1 ∈ α). apply 序数传递 with τ...
  rewrite 顶迭代极限次, 左迭代极限次...
  外延; apply 集族并除去 in H as [n [Hn H]].
  - apply 集族并介入 with n... apply 序数传递 with ((α ^^ᵀ n) τ)... apply 有限顶迭代小于左迭代...
  - apply 集族并介入 with n⁺... apply 序数传递 with (α ^^ᴸ n)... apply 有限左迭代小于后继顶迭代...
Qed.
```

下一讲: [Coq集合论讲座 (2-12: ε层级, ζ层级, η层级)](https://zhuanlan.zhihu.com/p/443299880)
