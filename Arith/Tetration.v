(** Coq coding by choukh, Nov 2021 **)

Require Import BBST.Theory.Ordinal.
Require Import BBST.Theory.OrdinalOperation.
Require Import BBST.Arith.Nat.
Require Import BBST.Arith.Ord.

Local Hint Immediate Ï‰ä¸ºåºæ•°é›† : core.
Local Hint Resolve ğğä¸ºä¼ é€’ç±» ä¸€ä¸ºåºæ•° :core.

Definition å·¦è¿­ä»£ := Î» Î±, åºæ•°é€’å½’ Î± (å¹‚è¿ç®— Î±).
Notation "Î± ^^á´¸ Î²" := (å·¦è¿­ä»£ Î± Î²) (at level 25) : åºæ•°ç®—æœ¯åŸŸ.

Theorem å·¦è¿­ä»£ä¸ºåºæ•°è¿ç®— : âˆ€ Î± Î² â‹µ ğğ, Î± ^^á´¸ Î² â‹µ ğğ.
Proof. intros. apply åºæ•°è¿ç®—çš„é€’å½’ä¸ºåºæ•°è¿ç®—; auto. Qed.
Local Hint Resolve å·¦è¿­ä»£ä¸ºåºæ•°è¿ç®— : core.

Theorem å·¦è¿­ä»£é›¶æ¬¡ : âˆ€Î± â‹µ ğğ, Î± ^^á´¸ 0 = Î±.
Proof. intros. apply åºæ•°é€’å½’_0; auto. Qed.

Theorem å·¦è¿­ä»£åç»§æ¬¡ : âˆ€ Î± Î² â‹µ ğğ, Î± ^^á´¸ Î²âº = Î± ^ (Î± ^^á´¸ Î²).
Proof. intros. apply åºæ•°é€’å½’_åç»§; auto. Qed.

Theorem å·¦è¿­ä»£æé™æ¬¡ : âˆ€Î± â‹µ ğğ, æé™å¤„è¿ç»­ (å·¦è¿­ä»£ Î±).
Proof. intros. apply åºæ•°é€’å½’_æé™; auto. Qed.

Lemma å·¦è¿­ä»£æœ‰é™é€’å¢ : âˆ€Î± â‹µ ğğ, 1 âˆˆ Î± â†’ æœ‰é™é€’å¢ (å·¦è¿­ä»£ Î±).
Proof with auto.
  intros Î± HÎ± H1 n Hn. å½’çº³ n.
  - rewrite å·¦è¿­ä»£åç»§æ¬¡, å·¦è¿­ä»£é›¶æ¬¡... apply å¹‚è¿ç®—æ”¾å¤§...
  - rewrite å·¦è¿­ä»£åç»§æ¬¡, å·¦è¿­ä»£åç»§æ¬¡... apply å¹‚è¿ç®—ä¿åº...
Qed.

Fact å·¦è¿­ä»£æœ‰é™ä¿åº : âˆ€Î± â‹µ ğğ, 1 âˆˆ Î± â†’ æœ‰é™ä¿åº (å·¦è¿­ä»£ Î±).
Proof with auto.
  intros Î± HÎ± H1 n Hn m. å½’çº³ n; intro Hmn. ç©ºé›†å½’è°¬.
  apply åç»§é™¤å» in Hmn as [].
  - apply åºæ•°ä¼ é€’ with (Î± ^^á´¸ n)... apply å·¦è¿­ä»£æœ‰é™é€’å¢...
  - subst. apply å·¦è¿­ä»£æœ‰é™é€’å¢...
Qed.

Lemma å·¦è¿­ä»£Ï‰æ¬¡ä¸ºæé™ : âˆ€Î± â‹µ ğğ, 1 âˆˆ Î± â†’ Î± ^^á´¸ Ï‰ â‹µ ğ‹ğˆğŒ.
Proof with auto.
  intros Î± HÎ± H1. split...
  rewrite å·¦è¿­ä»£æé™æ¬¡... å¤–å»¶.
  - apply å¹¶é›†é™¤å» in H as [Î² [HÎ² H]].
    apply é›†æ—å¹¶é™¤å» in HÎ² as [n [Hn HÎ²]].
    apply é›†æ—å¹¶ä»‹å…¥ with n... apply åºæ•°ä¼ é€’ with Î²...
  - apply é›†æ—å¹¶é™¤å» in H as [n [Hn H]].
    apply å¹¶é›†ä»‹å…¥ with (Î± ^^á´¸ n)...
    apply é›†æ—å¹¶ä»‹å…¥ with nâº. apply æé™åºæ•°æœ‰å…¶ä»»æ„å…ƒç´ çš„åç»§...
    apply å·¦è¿­ä»£æœ‰é™é€’å¢...
Qed.

Lemma å·¦è¿­ä»£ä¸ºé›¶ : âˆ€ Î± Î² â‹µ ğğ, Î± ^^á´¸ Î² = 0 â†’ Î± = 0.
Proof with eauto.
  intros Î± HÎ±. è¶…é™å½’çº³ Î² HÎ². è¶…é™è®¨è®º Î²; intros Heq.
  - rewrite å·¦è¿­ä»£é›¶æ¬¡ in Heq...
  - rewrite å·¦è¿­ä»£åç»§æ¬¡ in Heq... apply å¹‚ä¸ºé›¶ in Heq...
  - rewrite å·¦è¿­ä»£æé™æ¬¡ in Heq...
    apply é›†æ—å¹¶ä¸ºé›¶ in Heq as []... exfalso...
Qed.

Lemma å·¦è¿­ä»£åœ¨Ï‰åç»§å¤„ä¸é€’å¢ : âˆ€Î± â‹µ ğğ, 1 âˆˆ Î± â†’ Î± ^^á´¸ Ï‰âº = Î± ^^á´¸ Ï‰.
Proof with auto.
  intros Î± HÎ± H1. rewrite å·¦è¿­ä»£åç»§æ¬¡, æé™æ¬¡å¹‚, å·¦è¿­ä»£æé™æ¬¡...
  2: apply å·¦è¿­ä»£Ï‰æ¬¡ä¸ºæé™...
  2: { intros H. apply å·¦è¿­ä»£ä¸ºé›¶ in H... apply å¤§äºä¸€çš„åºæ•°ä¸ä¸ºé›¶ with Î±... }
  å¤–å»¶.
  - apply é›†æ—å¹¶é™¤å» in H as [y [Hy Hx]].
    apply é›†æ—å¹¶é™¤å» in Hy as [n [Hn Hy]].
    apply é›†æ—å¹¶ä»‹å…¥ with nâº... apply åºæ•°ä¼ é€’ with (Î± ^ y)...
    rewrite å·¦è¿­ä»£åç»§æ¬¡... apply å¹‚è¿ç®—ä¿åº...
  - apply é›†æ—å¹¶é™¤å» in H as [n [Hn Hx]].
    apply é›†æ—å¹¶ä»‹å…¥ with (Î± ^^á´¸ n).
    apply é›†æ—å¹¶ä»‹å…¥ with nâº... apply å·¦è¿­ä»£æœ‰é™é€’å¢...
    apply åºæ•°ä¼ é€’ with (Î± ^^á´¸ n)... rewrite <- å·¦è¿­ä»£åç»§æ¬¡... apply å·¦è¿­ä»£æœ‰é™é€’å¢...
Qed.

Theorem å·¦è¿­ä»£åœ¨Ï‰ä¹‹åä¸å˜ : âˆ€Î± â‹µ ğğ, 1 âˆˆ Î± â†’ âˆ€Î² â‹µ ğğ, Ï‰ âˆˆ Î² â†’ Î± ^^á´¸ Î² = Î± ^^á´¸ Ï‰.
Proof with auto.
  intros Î± HÎ± H1. è¶…é™å½’çº³ Î²; intros H. è¶…é™è®¨è®º Î². ç©ºé›†å½’è°¬.
  - apply åç»§é™¤å» in H as []...
    + rewrite å·¦è¿­ä»£åç»§æ¬¡, å½’çº³å‡è®¾, <- å·¦è¿­ä»£åç»§æ¬¡, å·¦è¿­ä»£åœ¨Ï‰åç»§å¤„ä¸é€’å¢...
    + subst... apply å·¦è¿­ä»£åœ¨Ï‰åç»§å¤„ä¸é€’å¢...
  - rewrite å·¦è¿­ä»£æé™æ¬¡... å¤–å»¶. 2: apply é›†æ—å¹¶ä»‹å…¥ with Ï‰...
    apply é›†æ—å¹¶é™¤å» in H2 as [Î³ [HÎ³ Hx]]. assert (HÎ³o: Î³ â‹µ ğğ). eauto.
    destruct (åºæ•°ä¸‰æ­§ Î³ HÎ³o Ï‰) as [|[]]... subst... 2: rewrite <- (å½’çº³å‡è®¾ Î³)...
    apply åºæ•°ä¼ é€’ with (Î± ^^á´¸ Î³)... rewrite (å·¦è¿­ä»£æé™æ¬¡ Î± HÎ± Ï‰)...
    apply é›†æ—å¹¶ä»‹å…¥ with Î³âº... apply å·¦è¿­ä»£æœ‰é™é€’å¢...
Qed.

Definition å³è¿­ä»£ := Î» Î±, åºæ•°é€’å½’ Î± (Î» Î¾, Î¾ ^ Î±).
Notation "Î± ^^á´¿ Î²" := (å³è¿­ä»£ Î± Î²) (at level 25) : åºæ•°ç®—æœ¯åŸŸ.

Theorem å³è¿­ä»£ä¸ºåºæ•°è¿ç®— : âˆ€ Î± Î² â‹µ ğğ, Î± ^^á´¿ Î² â‹µ ğğ.
Proof. intros. apply åºæ•°è¿ç®—çš„é€’å½’ä¸ºåºæ•°è¿ç®—; auto. Qed.
Local Hint Resolve å³è¿­ä»£ä¸ºåºæ•°è¿ç®— : core.

Theorem å³è¿­ä»£é›¶æ¬¡ : âˆ€Î± â‹µ ğğ, Î± ^^á´¿ 0 = Î±.
Proof. intros. apply åºæ•°é€’å½’_0; auto. Qed.

Theorem å³è¿­ä»£åç»§æ¬¡ : âˆ€ Î± Î² â‹µ ğğ, Î± ^^á´¿ Î²âº = (Î± ^^á´¿ Î²) ^ Î±.
Proof. intros. apply åºæ•°é€’å½’_åç»§; auto. Qed.

Theorem å³è¿­ä»£æé™æ¬¡ : âˆ€Î± â‹µ ğğ, æé™å¤„è¿ç»­ (å³è¿­ä»£ Î±).
Proof. intros. apply åºæ•°é€’å½’_æé™; auto. Qed.

Lemma å³è¿­ä»£äºä¸€ : âˆ€Î± â‹µ ğğ, 1 ^^á´¿ Î± = 1.
Proof with auto.
  è¶…é™å½’çº³. è¶…é™è®¨è®º Î±.
  - rewrite å³è¿­ä»£é›¶æ¬¡...
  - rewrite å³è¿­ä»£åç»§æ¬¡, ä¸€æ¬¡å¹‚...
  - rewrite å³è¿­ä»£æé™æ¬¡... å¤–å»¶.
    + apply é›†æ—å¹¶é™¤å» in H as [Î² [HÎ² H]]. rewrite å½’çº³å‡è®¾ in H...
    + simpl in H. apply åç»§é™¤å» in H as []... ç©ºé›†å½’è°¬. subst.
      apply é›†æ—å¹¶ä»‹å…¥ with âˆ…... rewrite å³è¿­ä»£é›¶æ¬¡... simpl...
Qed.

Theorem å³è¿­ä»£è¡¨è¾¾å¼ : âˆ€ Î± Î² â‹µ ğğ, Î± â‰  0 â†’ Î± ^^á´¿ Î² = Î± ^ (Î± ^ Î²).
Proof with auto.
  intros Î± HÎ±. è¶…é™å½’çº³ Î² HÎ². intros HÎ±0.
  æ’ä¸­ (Î± = 1) as [|HÎ±1]. {
    subst. rewrite å³è¿­ä»£äºä¸€, åº•æ•°ä¸ºä¸€çš„å¹‚...
  }
  è¶…é™è®¨è®º Î².
  - rewrite å³è¿­ä»£é›¶æ¬¡, é›¶æ¬¡å¹‚, ä¸€æ¬¡å¹‚...
  - rewrite å³è¿­ä»£åç»§æ¬¡, å½’çº³å‡è®¾, <- æŒ‡æ•°ç§¯è¿ç®—å¾‹, åç»§æ¬¡å¹‚...
  - rewrite å³è¿­ä»£æé™æ¬¡, æé™æ¬¡å¹‚...
    2: apply å¹‚ä¸ºæé™_å³...
    2: intros H; apply å¹‚ä¸ºé›¶ in H...
    å¤–å»¶.
    + apply é›†æ—å¹¶é™¤å» in H as [Î³ [HÎ³ H]]. assert (HÎ³o: Î³ â‹µ ğğ). eauto.
      apply é›†æ—å¹¶ä»‹å…¥ with (Î± ^ Î³)... apply å¹‚è¿ç®—ä¿åº... rewrite <- å½’çº³å‡è®¾...
    + apply é›†æ—å¹¶é™¤å» in H as [Î³ [HÎ³ Hx]]. rewrite æé™æ¬¡å¹‚ in HÎ³...
      apply é›†æ—å¹¶é™¤å» in HÎ³ as [Î´ [HÎ´ HÎ³]].
      assert (HÎ³o: Î³ â‹µ ğğ). eauto.
      assert (HoÎ´: Î´ â‹µ ğğ). eauto.
      apply é›†æ—å¹¶ä»‹å…¥ with Î´... rewrite å½’çº³å‡è®¾...
      apply åºæ•°ä¼ é€’ with (Î± ^ Î³)... apply å¹‚è¿ç®—ä¿åº...
Qed.

(* Î± ^ Î± ^ ... ^ Î± ^ Ï„ *)
Definition é¡¶è¿­ä»£ := Î» Î± Î² Ï„, åºæ•°é€’å½’ Ï„ (å¹‚è¿ç®— Î±) Î².
Notation "Î± ^^áµ€ Î²" := (é¡¶è¿­ä»£ Î± Î²) (at level 25) : åºæ•°ç®—æœ¯åŸŸ.

Theorem é¡¶è¿­ä»£ä¸ºåºæ•°è¿ç®— : âˆ€ Ï„ Î± Î² â‹µ ğğ, (Î± ^^áµ€ Î²) Ï„ â‹µ ğğ.
Proof. intros. apply åºæ•°è¿ç®—çš„é€’å½’ä¸ºåºæ•°è¿ç®—; auto. Qed.
Local Hint Resolve é¡¶è¿­ä»£ä¸ºåºæ•°è¿ç®— : core.

Theorem é¡¶è¿­ä»£é›¶æ¬¡ : âˆ€ Ï„ Î± â‹µ ğğ, (Î± ^^áµ€ 0) Ï„ = Ï„.
Proof. intros. apply åºæ•°é€’å½’_0; auto. Qed.

Theorem é¡¶è¿­ä»£åç»§æ¬¡ : âˆ€ Ï„ Î± Î² â‹µ ğğ, (Î± ^^áµ€ Î²âº) Ï„ = Î± ^ (Î± ^^áµ€ Î²) Ï„.
Proof. intros. apply åºæ•°é€’å½’_åç»§; auto. Qed.

Theorem é¡¶è¿­ä»£æé™æ¬¡ : âˆ€ Ï„ Î± â‹µ ğğ, æé™å¤„è¿ç»­ (Î» Î², (Î± ^^áµ€ Î²) Ï„).
Proof. intros. apply åºæ•°é€’å½’_æé™; auto. Qed.

Theorem é¡¶è¿­ä»£ä¸€æ¬¡ : âˆ€ Ï„ Î± â‹µ ğğ, (Î± ^^áµ€ 1) Ï„ = Î± ^ Ï„.
Proof. intros. simpl. rewrite é¡¶è¿­ä»£åç»§æ¬¡, é¡¶è¿­ä»£é›¶æ¬¡; auto. Qed.

Lemma é¡¶è¿­ä»£æœ‰é™å¼±é€’å¢ : âˆ€ Ï„ Î± â‹µ ğğ, 1 âˆˆ Î± â†’ æœ‰é™å¼±é€’å¢ (Î» k, (Î± ^^áµ€ k) Ï„).
Proof with auto.
  intros Ï„ HÏ„ Î± HÎ± H1 n Hn. å½’çº³ n.
  - rewrite é¡¶è¿­ä»£é›¶æ¬¡, é¡¶è¿­ä»£ä¸€æ¬¡... apply å¹‚è¿ç®—å¼±æ”¾å¤§...
  - rewrite é¡¶è¿­ä»£åç»§æ¬¡, é¡¶è¿­ä»£åç»§æ¬¡... apply å¹‚è¿ç®—ä¿åº_å¼±å³...
Qed.

Fact é¡¶è¿­ä»£æœ‰é™å¼±ä¿åº : âˆ€ Ï„ Î± â‹µ ğğ, 1 âˆˆ Î± â†’ æœ‰é™å¼±ä¿åº (Î» k, (Î± ^^áµ€ k) Ï„).
Proof with auto.
  intros Ï„ HÏ„ Î± HÎ± H1 n Hn m. å½’çº³ n; intro Hmn. ç©ºé›†å½’è°¬.
  apply åç»§é™¤å» in Hmn as [].
  - apply åºæ•°ä¼ é€’_å¼± with ((Î± ^^áµ€ n) Ï„)... apply é¡¶è¿­ä»£æœ‰é™å¼±é€’å¢...
  - subst. apply é¡¶è¿­ä»£æœ‰é™å¼±é€’å¢...
Qed.

Lemma æœ‰é™é¡¶è¿­ä»£å°äºå·¦è¿­ä»£ : âˆ€Î± â‹µ ğğ, 1 âˆˆ Î± â†’ âˆ€Ï„ âˆˆ Î±, âˆ€n âˆˆ Ï‰, (Î± ^^áµ€ n) Ï„ âˆˆ Î± ^^á´¸ n.
Proof with auto.
  intros Î± HÎ± H1 Ï„ HÏ„Î± n Hn.
  assert (HÏ„: Ï„ â‹µ ğğ). eauto.
  å½’çº³ n.
  - rewrite é¡¶è¿­ä»£é›¶æ¬¡, å·¦è¿­ä»£é›¶æ¬¡...
  - rewrite é¡¶è¿­ä»£åç»§æ¬¡, å·¦è¿­ä»£åç»§æ¬¡... apply å¹‚è¿ç®—ä¿åº...
Qed.

Lemma æœ‰é™å·¦è¿­ä»£å°äºåç»§é¡¶è¿­ä»£ : âˆ€Î± â‹µ ğğ, âˆ€Ï„ âˆˆ Î±, 1 âˆˆ Ï„ â†’ âˆ€n âˆˆ Ï‰, Î± ^^á´¸ n âˆˆ (Î± ^^áµ€ nâº) Ï„.
Proof with auto.
  intros Î± HÎ± Ï„ HÏ„Î± H1 n Hn.
  assert (HÏ„: Ï„ â‹µ ğğ). eauto.
  assert (H1Î±: 1 âˆˆ Î±). apply åºæ•°ä¼ é€’ with Ï„...
  å½’çº³ n.
  - rewrite é¡¶è¿­ä»£ä¸€æ¬¡, å·¦è¿­ä»£é›¶æ¬¡... apply å¹‚è¿ç®—æ”¾å¤§...
  - rewrite é¡¶è¿­ä»£åç»§æ¬¡, å·¦è¿­ä»£åç»§æ¬¡... apply å¹‚è¿ç®—ä¿åº...
Qed.

Lemma æ— é™é¡¶è¿­ä»£ç­‰äºå·¦è¿­ä»£ : âˆ€Î± â‹µ ğğ, âˆ€Ï„ âˆˆ Î±, 1 âˆˆ Ï„ â†’ (Î± ^^áµ€ Ï‰) Ï„ = Î± ^^á´¸ Ï‰.
Proof with auto.
  intros Î± HÎ± Ï„ HÏ„Î± H1.
  assert (HÏ„: Ï„ â‹µ ğğ). eauto.
  assert (H1Î±: 1 âˆˆ Î±). apply åºæ•°ä¼ é€’ with Ï„...
  rewrite é¡¶è¿­ä»£æé™æ¬¡, å·¦è¿­ä»£æé™æ¬¡...
  å¤–å»¶; apply é›†æ—å¹¶é™¤å» in H as [n [Hn H]].
  - apply é›†æ—å¹¶ä»‹å…¥ with n... apply åºæ•°ä¼ é€’ with ((Î± ^^áµ€ n) Ï„)... apply æœ‰é™é¡¶è¿­ä»£å°äºå·¦è¿­ä»£...
  - apply é›†æ—å¹¶ä»‹å…¥ with nâº... apply åºæ•°ä¼ é€’ with (Î± ^^á´¸ n)... apply æœ‰é™å·¦è¿­ä»£å°äºåç»§é¡¶è¿­ä»£...
Qed.
